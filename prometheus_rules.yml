groups:
  - name: spam-api-alerts
    rules:
      - alert: SpamAPIHighLatency
        expr: histogram_quantile(0.95, sum by (le) (rate(request_latency_seconds_bucket[5m]))) > 1
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: High request latency
          description: p95 latency is above 1s over the last 5 minutes.

      - alert: SpamAPIErrorRate
        expr: >
          sum(rate(request_count{http_status=~"5.."}[5m]))
          / sum(rate(request_count[5m])) > 0.05
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: Elevated 5xx error rate
          description: Error rate is above 5% in the last 5 minutes.
